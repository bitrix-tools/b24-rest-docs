# Как передать информацию в Сквозную аналитику

{% note warning "Мы еще обновляем эту страницу" %}

Тут может не хватать некоторых данных — дополним в ближайшее время

{% endnote %}

{% if build == 'dev' %}

{% note alert "TO-DO _не выгружается на prod_" %}

- на странице упоминается метод crm.tracking.trace.add, который не описан нигде в доке

{% endnote %}

{% endif %}

> Scope: [`crm`](../../../api-reference/scopes/permissions.md)
>
> Кто может выполнять метод: пользователи с административным доступом к разделу CRM

При создании элементов CRM есть три способа передать информацию для сквозной аналитики.

## Самый простой

Передать в полях создаваемого элемента поле `UTM_SOURCE`.

В этом случае при создании элемента, если будет найден настроенный источник в сквозной аналитике с таким же `UTM_SOURCE`, элементу будет проставлен этот источник, будет выведена соответствующая иконка, элемент будет участвовать в отчете сквозной аналитики.

## Полные данные

Передать в полях создаваемого элемента поле `TRACE`.

В этом случае будут учтены все данные — устройство, все каналы, в том числе и сайт, посещенные страницы.

Способ работает для методов: [crm.lead.add](../../../api-reference/crm/leads/crm-lead-add.md), [crm.deal.add](../../../api-reference/crm/deals/crm-deal-add.md), [crm.contact.add](../../../api-reference/crm/contacts/crm-contact-add.md), [crm.company.add](../../../api-reference/crm/companies/crm-company-add.md), [crm.quote.add](../../../api-reference/crm/quote/crm-quote-add.md).

```json
{
    "fields": {
        "NAME": "test",
        "LAST_NAME": "",
        "TRACE": ...
    },
}
```

Значение **М** поля `TRACE` должен быть или идентификатор сохраненной записи сквозной аналитики или JSON-строка с массивом определенного формата, для получения которого можно просто воспользоваться JS-кодом виджета сквозной аналитики Битрикс24:

```js
b24Tracker.guest.getTrace()
```

Значение поля `TRACE` может быть число — `ID` трейса, который получен методом `crm.tracking.trace.add`.

## Создание трейса и получение его ID

Метод создает трейс:

```bash
crm.tracking.trace.add
?ENTITIES[0][TYPE]=CONTACT&ENTITIES[0][ID]=3215&ENTITIES[1][TYPE]=LEAD&ENTITIES[1][ID]=1&TRACE=
```

Поле `TRACE` обязательное, значение — строка, полученная методом `b24Tracker.guest.getTrace`. Пример выше.

Поле `ENTITIES` не обязательное, в нем можно перечислить сущности, которые связываются с этим трейсом:

```js
ENTITIES: [
    {
        TYPE: 'CONTACT',
        ID: 1
    },
    {
        TYPE: 'LEAD',
        ID: 101
    }
]
```

## Один трейс для связанных сущностей

Если создается пакет связанных сущностей (сделка + контакт + компания), то можно создать единый трейс для них. Если контакт и компания существующие, а создается только сделка, то можно создать трейс и привязать к существующим сущностям.

## Продолжите изучение

- [Использование сквозной аналитики при создании лида](./use-analitics-for-add-lead.md)
- [Использование сквозной аналитики при создании сделки и контакта](./use-analitics-for-add-contact.md)