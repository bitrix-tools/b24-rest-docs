# Создать чат-бот imbot.register

{% note warning "Мы еще обновляем эту страницу" %}

Тут может не хватать некоторых данных — дополним в ближайшее время

{% endnote %}

{% if build == 'dev' %}

{% note alert "TO-DO _не выгружается на prod_" %}

- нужны правки под стандарт написания
- не указаны типы параметров
- не для всех параметров есть пример в таблице
- отсутствуют примеры
- отсутствует ответ в случае успеха
- отсутствует ответ в случае ошибки
- не прописаны ссылки на несозданные ещё страницы

{% endnote %}

{% endif %}

> Scope: [`imbot`](../scopes/permissions.md)
>
> Кто может выполнять метод: любой пользователь

Метод `imbot.register` регистрирует чат-бота.

#|
|| **Параметр** | **Пример** | **Описание** | **Ревизия** ||
|| **CODE^*^**
[`unknown`](../data-types.md) | `'newbot'` | Строковой идентификатор бота, уникальный в рамках вашего приложения (обяз.) | ||
|| **TYPE**
[`unknown`](../data-types.md) | `'B'` | Тип, B – чат-бот, ответы поступают сразу, O – чат-бот для Открытых линий, S – чат-бот с повышенными привилегиями (supervisor) | ||
|| **EVENT_...^*^**
[`unknown`](../data-types.md) | `'http://www.hazz/chatApi/event.php'` | Ссылка на обработчик событий, поступивших от сервера. Обработчики событий:
- `EVENT_HANDLER` – ссылка на обработчик события отправки сообщения чат-боту.
или
- `EVENT_MESSAGE_ADD` – ссылка на обработчик события отправки сообщения чат-боту.
- `EVENT_WELCOME_MESSAGE` – ссылка на обработчик события открытия диалога с чат-ботом или приглашения его в групповой чат.
- `EVENT_BOT_DELETE` – ссылка на обработчик события удаления чат-бота со стороны клиента. | ||
|| **OPENLINE**
[`unknown`](../data-types.md) | `'Y'` | Включение режима поддержки Открытых линий, можно не указывать, если TYPE = 'O' | ||
|| **CLIENT_ID**
[`unknown`](../data-types.md) | `''` | строковый идентификатор, используется только в режиме Вебхуков | ||
|| **PROPERTIES^*^**
[`unknown`](../data-types.md) | | Личные данные чат-бота (обяз.) | ||
|| **NAME**
[`unknown`](../data-types.md) | `'NewBot'` | Имя чат-бота (обязательное одно из полей NAME или LAST_NAME) | ||
|| **LAST_NAME**
[`unknown`](../data-types.md) | `''` | Фамилия (обязательное одно из полей NAME или LAST_NAME) | ||
|| **COLOR**
[`unknown`](../data-types.md) | `'GREEN'` | Цвет для мобильного приложения RED, GREEN, MINT, LIGHT_BLUE, DARK_BLUE, PURPLE, AQUA, PINK, LIME, BROWN, AZURE, KHAKI, SAND, MARENGO, GRAY, GRAPHITE | ||
|| **EMAIL**
[`unknown`](../data-types.md) | `'test@test.ru'` | E-mail для связи. НЕЛЬЗЯ использовать e-mail, дублирующий e-mail реальных пользователей | ||
|| **PERSONAL_BIRTHDAY**
[`unknown`](../data-types.md) | `'2016-03-11'` | День рождения в формате YYYY-mm-dd | ||
|| **WORK_POSITION**
[`unknown`](../data-types.md) | `'Лучший сотрудник'` | Занимаемая должность, используется как описание чат-бота | ||
|| **PERSONAL_WWW**
[`unknown`](../data-types.md) | `'http://test.ru'` | Ссылка на сайт | ||
|| **PERSONAL_GENDER**
[`unknown`](../data-types.md) | `'F'` | Пол, допустимые значения M – мужской, F – женский, пусто, если не требуется указывать | ||
|| **PERSONAL_PHOTO**
[`unknown`](../data-types.md) | `'/* base64 image */'` | Аватар - base64 | ||
|#

{% include [Сноска о параметрах](../../_includes/required.md) %}


**Обратите внимание**, если это не требуется логикой вашего приложения, то рекомендуется отвечать боту на сообщения пользователя только при упоминании этого чат-бота. Проверить это можно по полю `TO_USER_ID`, которое будет передано в событие.

{% note info %}

**Чат-бот с повышенными привилегиями (supervisor)** получает доступ ко всем сообщениям в чатах, где он состоит (ко всем, если его пригласили с доступом к истории, и к новым, если доступ к истории ему не доступен).

{% endnote %}

Для его создания в методе **imbot.register** в поле `TYPE` укажите тип `S`.

## Примеры

{% include [Пояснение о restCommand](./_includes/rest-command.md) %}

{% list tabs %}

- PHP

    ```php
    $result = restCommand(
        'imbot.register',
        Array(
            'CODE' => 'newbot',
            'TYPE' => 'B',
            'EVENT_HANDLER' => 'http://www.hazz/chatApi/event.php',
            'OPENLINE' => 'Y',
            'CLIENT_ID' => '',
            'PROPERTIES' => Array(
                'NAME' => 'NewBot',
                'LAST_NAME' => '',
                'COLOR' => 'GREEN',
                'EMAIL' => 'test@test.ru',
                'PERSONAL_BIRTHDAY' => '2016-03-11',
                'WORK_POSITION' => 'Лучший сотрудник',
                'PERSONAL_WWW' => 'http://test.ru',
                'PERSONAL_GENDER' => 'F',
                'PERSONAL_PHOTO' => '/* base64 image */',
            )
        ),
        $_REQUEST[
            "auth"
        ]
    );
    ```

{% endlist %}

{% include [Сноска о примерах](../../_includes/examples.md) %}

## Ответ в случае успеха

Числовой идентификатор созданного бота `BOT_ID`.

## Ответ в случае ошибки

ошибка

### Возможные коды ошибок

#|
|| **Код** | **Описание** ||
|| **EVENT_MESSAGE_ADD_ERROR** | Ссылка обработчик события невалидная или не указана. ||
|| **EVENT_WELCOME_MESSAGE_ERROR** | Ссылка обработчик события невалидная или не указана. ||
|| **EVENT_BOT_DELETE_ERROR** | Ссылка обработчик события невалидная или не указана. ||
|| **CODE_ERROR** | Не указан строковый идентификатор. ||
|| **NAME_ERROR** | Не указано одно из обязательных полей **NAME** или **LAST_NAME**. ||
|| **WRONG_REQUEST** | Что-то пошло не так. ||
|| **MAX_COUNT_ERROR** | Достигнуто максимальное количество зарегистрированных ботов для одного приложения. ||
|#

## Обработчики событий

Если вам требуется обрабатывать события с помощью разных обработчиков, то вместо `EVENT_HANDLER` вы можете задать каждый обработчик индивидуально:

```php
'EVENT_MESSAGE_ADD' => 'http://www.hazz/chatApi/event.php', // Ссылка на обработчик события отправки сообщения чат-боту
'EVENT_WELCOME_MESSAGE' => 'http://www.hazz/chatApi/event.php', // Ссылка на обработчик события открытия диалога с чат-ботом или приглашения его в групповой чат
'EVENT_BOT_DELETE' => 'http://www.hazz/chatApi/event.php', // Ссылка на обработчик события удаления чат-бота со стороны клиента
'EVENT_MESSAGE_UPDATE' => 'http://www.hazz/chatApi/event.php', // Ссылка на обработчик события подписки на события изменения
'EVENT_MESSAGE_DELETE' => 'http://www.hazz/chatApi/event.php', // Ссылка на обработчик события подписки на события удаления сообщений
```

{% note warning %}

Если планируется устанавливать более одного чат-бота в рамках одного приложения: *Bitrix24 Rest* накладывает ограничение на работу с обработчиками событий – обработчик может быть только один на одно приложение. Поэтому при регистрации второго чат-бота ссылки на обработчики **EVENT_MESSAGE_ADD**, **EVENT_WELCOME_MESSAGE** и **EVENT_BOT_DELETE** должны быть такими же, как и у первого.

Если необходимо обрабатывать несколько ботов в рамках одного приложения, то необходимо предусмотреть это внутри обработчика событий. Для этого при поступлении события передается массив ботов, чтобы можно было корректно их обработать.

Максимальное количество ботов для одного приложения: 5.

{% endnote %}

## Ссылки по теме

[Rest API - События установки и обновления](./events/index.md)







