# Коннектор: обзор методов

Коннектор — это инструмент для интеграции Битрикс24 с внешними системами данных. Он отвечает за подключение к сторонним API и базам данных, импорт данных для аналитики и отчетов.

Каждый коннектор содержит настройки для работы с конкретным источником:
- эндпоинты — URL для отправки HTTP-запросов,
- параметры авторизации.
  
Зарегистрировать коннектор можно через [приложение](../../app-installation/index.md).

> Быстрый переход: [все методы](#all-methods) 

## Связь коннектора с источниками и датасетами

Коннектор — верхний уровень в иерархии работы с данными в модуле BIconnector:
- **Коннектор** устанавливает связь с внешним источником данных.
- **Источник** определяет, какие именно данные доступны из подключенного сервиса.
- **Датасет** формирует итоговый набор данных, который можно использовать в отчетах и аналитике.

## Описание полей коннектора {#fields}

#|
|| **Название**
`тип` | **Описание** | Чтение | Запись ||
|| **id**
[`integer`](../../data-types.md) | Уникальный идентификатор коннектора | ✅ | ❌ ||
|| **title**
[`string`](../../data-types.md) | Название коннектора | ✅ | ✅ ||
|| **logo**
[`string`](../../data-types.md) | URL логотипа или строка base64 | ✅ | ✅ ||
|| **description**
[`string`](../../data-types.md) | Описание коннектора | ✅ | ✅ ||
|| **sort**
[`integer`](../../data-types.md) | Порядок сортировки | ✅ | ✅ ||
|| **urlCheck**
[`string`](../../data-types.md) | [URL для проверки соединения](#urlCheck) | ✅ | ✅ ||
|| **urlData**
[`string`](../../data-types.md) | [URL для получения данных](#urlData) | ✅ | ✅ ||
|| **urlTableList**
[`string`](../../data-types.md) | [URL для списка таблиц](#urlTableList) | ✅ | ✅ ||
|| **urlTableDescription**
[`string`](../../data-types.md) | [URL для описания таблицы](#urlTableDescription) | ✅ | ✅ ||
|| **settings**
[`array`](../../data-types.md) | [Настройки коннектора](#settings) | ✅ | ✅ ||
|| **dateCreate**
[`datetime`](../../data-types.md) | Дата создания коннектора | ✅ | ❌ ||
|#

### Поле settings {#settings}

Поле `settings` содержит массив параметров, необходимых для настройки источников данных. Каждый параметр это объект со следующей структурой:

- `code` — код параметра, используется как идентификатор параметра, именно с такими названиями и передаются параметры во внешний источник.
- `name` — название параметра, которое будет отображаться в интерфейсе, в разделе «Рабочее место аналитика».
- `type` — тип параметра, на данный момент поддерживается только `STRING`.

```
{
    "code": "code_value"
    "name": "name_value"
    "type": "type_value"
}
```

### Эндпоинты коннектора

#### urlCheck {#urlCheck}

Эндпоинт `urlCheck` выполняет две ключевые функции:

1. Проверку доступности соединения с внешним источником.
2. Аутентификацию пользователя.

Вызов эндпоинта происходит:

-  при создании нового подключения,
-  редактировании существующего подключения,
-  создании датасета.

На адрес эндпоинта отправляется POST-запрос с параметрами:

- `setting_code_n` — код параметра настроек коннектора.
- `settings_value_n` — значение этого параметра, связанное с конкретным источником.

```
{
  "connection": {
    "setting_code_1": "settings_value_1",
    ...,
    "setting_code_n": "settings_value_n"
  }
}
```

В зависимости от доступности, эндпоинт возвращает информацию о статусе источника. Требования к формату ответа эндпоинта на запрос от Битрикс24: ответ должен быть не пустой, HTTP-статус: **200**. Формат ответа свободный.
Запрос к эндпоинту для проверки подключения можно отправить в интерфейсе, раздел «Рабочее место аналитика».

#### urlTableList {#urlTableList}

Эндпоинт `urlTableList` возвращает список доступных таблиц в формате `JSON`. Эндпоинт вернет таблицы, которые соответствуют поисковому запросу. Вызов эндпоинта происходит при создании датасета через интерфейс.

На адрес эндпоинта отправляется POST-запрос с параметрами:

- `searchString` — значение строки поиска, ищет таблицы по `externalCode`.
- `setting_code_n` — код параметра настроек коннектора.
- `settings_value_n` — значение этого параметра, связанное с конкретным источником.

```
{
  "searchString": "search_value"
  "connection": {
    "setting_code_1": "settings_value_1",
    ...,
    "setting_code_n": "settings_value_n"
  }
}
```

Ответ возвращает массив объектов, соответствующих запросу, со структурой:

- `code` — название датасета, которое будет использовано в Битрикс24.
- `title` — название датасета во внешнем источнике. По этому полю осуществляется поиск.

```
	{
	    'code' => 'dataset_name',
	    'title' => 'exernalName'
	}
```

#### urlTableDescription {#urlTableDescription}

Эндпоинт `urlTableDescription` возвращает список полей конкретной таблицы в формате `JSON`. Вызов эндпоинта происходит при создании датасета через интерфейс.

На адрес эндпоинта отправляется POST-запрос с параметрами:

- `table` — `externalCode` датасета, для которого запрошено описание.
- `setting_code_n` — код параметра настроек коннектора.
- `settings_value_n` — значение этого параметра, связанное с конкретным источником.

```
{
  "table": "entityName"
  "connection": {
    "setting_code_1": "settings_value_1",
    ...,
    "setting_code_n": "settings_value_n"
  }
}
```

Ответ возвращает массив полей со структурой:
- `code` — код поля датасета.
- `title` — название поля датасета.
- `type` — тип поля, поддерживаются значения: `int`, `string`, `double`, `date`, `datetime`.

```
  {
      'code' => "code_value",
      'title' => "title_value",
      'type' => "type_value"
  }
```

#### urlData {#urlData}

Эндпоинт `urlData` возвращает данные конкретной таблицы в формате `JSON`.

Вызов эндпоинта происходит:
- при создании датасета через интерфейс,
- синхронизации полей датасета через интерфейс,
- выполнении запросов для получения данных для BI Конструктора.

На адрес эндпоинта отправляется POST-запрос с параметрами:

- `select` — выборка полей датасета.
- `filter` — фильтр по полям датасета.
- `limit` — лимит выборки датасета.
- `table` — `externalCode` датасета, для которого запрошены данные.
- `setting_code_n` — код параметра настроек коннектора.
- `settings_value_n` — значение этого параметра, связанное с конкретным источником.

```
{
  "select": **array**
  "filter": **object**
  "limit": **int**
  "table": "entityName"
  "connection": {
    "setting_code_1": "settings_value_1",
    ...,
    "setting_code_n": "settings_value_n"
  }
}
```

Ответ возвращает массив полей со структурой:

- `FIELD_N` — код поля.
- `VALUE_ROW_M_N` — значения поля `N` в строке `M`.

```
[
["FIELD_1","FIELD_2",...,"FIELD_N"]
,[VALUE_ROW_1_1,VALUE_ROW_1_2,...,VALUE_ROW_1_N,]
,[VALUE_ROW_2_1,VALUE_ROW_2_2,...,VALUE_ROW_2_N,]
 ...
,[VALUE_ROW_M_1,VALUE_ROW_M_2,...,VALUE_ROW_M_N,]
]
```

## Параметры полей {#description}

#|
|| **Название**
`тип` | **Описание** ||
|| **title**
[`string`](../../data-types.md) | Название поля ||
|| **type**
[`string`](../../data-types.md) | Тип поля ||
|| **isRequired**
[`boolean`](../../data-types.md) | Обязательное поле ||
|| **isReadOnly**
[`boolean`](../../data-types.md) | Поле доступно только для чтения ||
|| **isImmutable**
[`boolean`](../../data-types.md) | Установить значение поля можно только один раз и только при создании нового элемента. После этого значение поля не может быть изменено ||
|| **isMultiple**
[`boolean`](../../data-types.md) | Множественное поле. Если равно `true`, значения в поле передаются в виде массива ||
|#

## Обзор методов {#all-methods}

> Scope: [`biconnector`](../../scopes/permissions.md)
>
> Кто может выполнять методы: пользователь с доступом к разделу «Рабочее место аналитика»

#|
|| **Метод** | **Описание** ||
|| [biconnector.connector.add](./biconnector-connector-add.md) | Добавляет новый коннектор ||
|| [biconnector.connector.update](./biconnector-connector-update.md) | Обновляет существующий коннектор ||
|| [biconnector.connector.get](./biconnector-connector-get.md) | Возвращает информацию о коннекторе ||
|| [biconnector.connector.list](./biconnector-connector-list.md) | Возвращает список доступных коннекторов ||
|| [biconnector.connector.delete](./biconnector-connector-delete.md) | Удаляет коннектор ||
|| [biconnector.connector.fields](./biconnector-connector-fields.md) | Возвращает описание полей коннектора ||
|#