# Пользовательские поля сделок: обзор методов

Пользовательские поля хранят информацию о сделке в различных форматах данных: строка, число, ссылка, адрес и другие. 

> Быстрый переход: [все методы](#all-methods) 
> 
> Пользовательская документация: [Пользовательские поля в CRM](https://helpdesk.bitrix24.ru/open/22048980/)

## Типы пользовательских полей

Используйте метод [crm.userfield.types](../../universal/user-defined-fields/crm-userfield-types.md) для получения доступных типов пользовательских полей. Метод вернет ID и название типов полей.

````
    (
        [ID] => double    
        [title] => Число
    )
````

Используйте метод [crm.userfield.fields](../../universal/user-defined-fields/crm-userfield-fields.md) для получения списка характеристик пользовательских полей. Метод вернет коды характеристик с их типом и названием.

````
    [MANDATORY] => Array
                (
                    [type] => char
                    [title] => Обязательное
                )
````

## Настройки пользовательских полей

Используйте метод [crm.userfield.settings.fields](../../universal/user-defined-fields/crm-userfield-settings-fields.md), чтобы получить список доступных настроек. Метод вернет поддерживаемые настройки для запрошенного типа поля. 

````
    [DEFAULT_VALUE] => Array
            (
                [type] => double
                [title] => Значение по умолчанию
            )
    [PRECISION] => Array
            (
                [type] => int
                [title] => Точность
            )
````

## Ошибки при работе с пользовательскими полями

При создании или удалении пользовательских полей запрос может прерваться с ошибкой [INTERNAL_SERVER_ERROR](../../../../error-codes.md). Это внутренняя ошибка сервера. Причину ошибки можно найти в логах сервера на момент выполнения запроса: 
* В облачном Битрикс24 напишите обращение в техническую поддержку чтобы получить детали ошибки. 
* В коробочном Битрикс24 запросите лог ошибок сервера у администратора сервера или администратора хостинга. После напишите в техническую поддержку и приложите лог для анализа. 

### Частые причины серверных ошибок

1. Для сделок можно создать 1016 пользовательских полей — это ограничение архитектуры базы данных. Если в Битрикс24 уже есть 1016 полей для сделок, при попытке создать новое поле метод [crm.deal.userfield.add](./crm-deal-userfield-add.md) вернет ошибку [INTERNAL_SERVER_ERROR](../../../../error-codes.md). 

    Проверить количество пользовательских полей сделок можно методом [crm.deal.userfield.list](./crm-deal-userfield-list.md). 

2. На серверах есть ограничение для времени выполнения одного запроса — `max_execution_time`. Стандартное время — 60 секунд. Если запрос выполняется дольше, он прерывается с ошибкой [INTERNAL_SERVER_ERROR](../../../../error-codes.md). 

    Время [создания](./crm-deal-userfield-add.md) или [удаления](./crm-deal-userfield-delete.md) пользовательского поля сделок зависит от количества сделок. Когда поле создается, оно добавляется во все карточки сделок. Когда поле удаляется, оно удаляется из всех карточек. Чем меньше сделок в вашем Битрикс24, тем быстрее создаются и удаляются поля.
   
    Чтобы проверить количество сделок в Битрикс24 используйте метод [crm.deal.list](../crm-deal-list.md).

## Обзор методов {#all-methods}

> Scope: [`crm`](../../../scopes/permissions.md)
>
> Кто может выполнять методы: в зависимости от метода

{% list tabs %}

- Методы

    #|
    || **Метод** | **Описание** ||
    || [crm.deal.userfield.add](./crm-deal-userfield-add.md) | Создает новое пользовательское поле для сделок ||
    || [crm.deal.userfield.update](./crm-deal-userfield-update.md) | Изменяет существующее пользовательское поле сделок ||
    || [crm.deal.userfield.get](./crm-deal-userfield-get.md) | Получает пользовательское поле сделок по Id ||
    || [crm.deal.userfield.list](./crm-deal-userfield-list.md) | Получает списка пользовательских полей сделок ||
    || [crm.deal.userfield.delete](./crm-deal-userfield-delete.md) | Удаляет пользовательское поле сделок ||
    |#

- События

    #|
    || **Событие** | **Вызывается** ||
    || [onCrmDealUserFieldAdd](./events/on-crm-deal-user-field-add.md) | При добавлении пользовательского поля ||
    || [onCrmDealUserFieldUpdate](./events/on-crm-deal-user-field-update.md) | При изменении пользовательского поля ||
    || [onCrmDealUserFieldDelete](./events/on-crm-deal-user-field-delete.md) | При удалении пользовательского поля ||
    || [onCrmDealUserFieldSetEnumValues](./events/on-crm-deal-user-field-set-enum-values.md) | При изменении набора значений для пользовательского поля списочного типа ||
    |#

{% endlist %}