# Счета

{% if build == 'dev' %}

{% note alert "TO-DO _не выгружается на prod_" %}

- правки под стандарт
- добавить ссылки:
- - на константы, если будет
- - на crm.enum.ownertype  и на crm.status.entity.types после Вспомогательных сущностей
- - на смарт процессы
- - на methodscrmcategory/category.php  

{% endnote %}

{% endif %}

> Scope: [`crm`](../../scopes/permissions.md)
>
> Кто может выполнять метод: любой пользователь

**Новые счета** – это отдельный тип сущности, заменяющий собой существовавшие до этого [счета](../outdated/index.md).

## Как смарт-процесс

Новые счета – это зафиксированный тип смарт-процесса, за исключением деталей. Поэтому те же самые методы, которые применяются при работе со смарт-процессами, используются и с новыми счетами. Отличие лишь в значениях входных параметров.

Многие методы требуют указать `entityTypeId`. В качестве значения для этого параметра необходимо передать `entityTypeId` для новых счетов. Значение `entityTypeId` для новых счетов, а также других специфичных для типа сущности констант, можно посмотреть в списке [констант](.).

Также значения `entityTypeId`, `entityTypeName` и `ownerType` можно получить через метод [crm.enum.ownertype](.) (см. поля `ID`, `SYMBOL_CODE`, `SYMBOL_CODE_SHORT`).

## crm.type.*

Через методы [crm.type.*](.) прочитать/изменить/удалить новые счета **невозможно**. При попытке это сделать будет возвращена ошибка.

## Управление элементами новых счетов – crm.item.*

Через методы [crm.item.*](.) можно [читать](.)/[изменять](.)/[удалять](.)/[добавлять](.) элементы новых счетов. Работа с новыми счетами через них ничем не отличается от того, что описано в документации. В качестве параметра `entityTypeId` необходимо передать значение, актуальное для новых счетов.

## Управление товарными позициями – crm.item.productrow.*

Через методы [crm.item.productrow.*](../productrow/index.md) можно управлять товарными позициями, привязанными к счету. Работа с ними аналогична таковой для элементов смарт-процесса. В качестве параметра `ownerType` необходимо передавать краткий символьный код для новых счетов (`SI`).

## Управление стадиями – crm.status.*

Через методы [crm.status.*](.) можно управлять стадиями новых счетов. Значение поля `ENTITY_ID` и `STATUS_ID` формируется по тому же принципу, что и для смарт-процессов.

Чтобы получить значение готовое `ENTITY_ID` для новых счетов, можно воспользоваться методом [crm.status.entity.types](.) и найти там подмассив, у которого `ENTITY_TYPE_ID` совпадает с `entityTypeId` для новых счетов. Под ключом `ID` будет нужное значение, которое можно подставлять как `ENTITY_ID` в другие методы.

## crm.category.*

Так как новые счета основаны на смарт-процессах, то они имеют техническую возможность работать с направлениями. Однако **не рекомендуется** использовать методы [crm.category.*](.) для изменения направлений новых счетов, так как направления в них не используются. В интерфейсе любые изменения отображены не будут.

## Настройки карточки счета – crm.item.details.configuration.*

Через методы [crm.item.details.configuration.*](.) можно управлять настройками карточки нового счета. В качестве `entityTypeId` необходимо передавать актуальное для нового счета значение.

## События над элементами нового счета

При добавлении/изменении/удалении элемента нового счета, будут выбрасываться события, идентичные таковым у [смарт-процесса](.). В качестве значения для `ENTITY_TYPE_ID` будет передаваться идентификатор CRM нового счета (`entityTypeId`).

## Встройки в интерфейс

Коды встроек генерируются таким же образом, как и для других сущностей, но в качестве строкового названия используется `SMART_INVOICE`, например:
- `CRM_SMART_INVOICE_LIST_TOOLBAR` – кнопка в тулбаре в списке счетов
- `CRM_SMART_INVOICE_DETAIL_TOOLBAR` – кнопка в тулбаре в карточке счета
- `CRM_SMART_INVOICE_DOCUMENTGENERATOR_BUTTON` – пункт меню в кнопке "Документ" в карточке счета

... и другие
