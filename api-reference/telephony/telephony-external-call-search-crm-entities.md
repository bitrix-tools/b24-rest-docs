# Получить по номеру телефона информации о клиенте из CRM telephony.externalCall.searchCrmEntities

{% note warning "Мы еще обновляем эту страницу" %}

Тут может не хватать некоторых данных — дополним в ближайшее время

{% endnote %}

{% if build == 'dev' %}

{% note alert "TO-DO _не выгружается на prod_" %}

- не указаны типы параметров
- отсутствуют примеры
- отсутствует ответ в случае ошибки

{% endnote %}

{% endif %}

{% include notitle [Скоуп telephony all](./_includes/scope-telephony-all.md) %}

Метод `telephony.externalCall.searchCrmEntities` позволяет получить одним запросом по номеру телефона информацию о клиенте из CRM. Информация позволяет принять решение, кому из сотрудников перенаправить входящий звонок на пользователя прямо в этот момент. Метод возвращает подходящий список CRM-объектов с сортировкой по внутренним приоритетам. Если за сущности связанные с номером отвечают разные сотрудники (за лид отвечает один сотрудник, за компанию - другой), то рекомендуется брать тот объект, который метод вернул первым в списке. Если интеграция предполагает собственную логику, то возможен выбор, так как отдаются все объекты.

В списке объектов CRM сразу сообщается вся информация об ответственном сотруднике за каждый объект (чтобы не приходилось получать эти данные дополнительными запросами REST). Возвращаются все заданные у пользователя контактные телефоны: внутренний телефон сотрудника, мобильный, рабочий и т.д.

Возвращается и статус рабочего дня сотрудника (если в Битрикс24 включен учет рабочего времени). Интеграция может проверить, находится ли сотрудник на рабочем месте (или у него перерыв), и либо перенаправить входящий звонок в очередь, либо направить звонок на мобильник сотрудника и т.д.

Рекомендуется вызывать метод до вызова [telephony.externalcall.register](telephony-external-call-register.md).

#|
|| **Параметр** | **Описание** ||
|| **PHONE_NUMBER**^*^ | Номер клиента. ||
|#

{% include [Сноска о параметрах](../../_includes/required.md) %}

## Ответ в случае успеха

> 200 OK

Пример возвращаемых данных

```json
Array
(
    [0] => Array
    (
        [CRM_ENTITY_TYPE] => CONTACT
        [CRM_ENTITY_ID] => 1
        [ASSIGNED_BY_ID] => 1
        [ASSIGNED_BY] => Array
            (
                [ID] => 1
                [TIMEMAN_STATUS] => CLOSED
                [USER_PHONE_INNER] => 102
                [WORK_PHONE] =>
                [PERSONAL_PHONE] =>
                [PERSONAL_MOBILE] => 79062195047
            )

    )

    [1] => Array
    (
        [CRM_ENTITY_TYPE] => COMPANY
        [CRM_ENTITY_ID] => 4
        [ASSIGNED_BY_ID] => 1
        [ASSIGNED_BY] => Array
            (
                [ID] => 1
                [TIMEMAN_STATUS] => CLOSED
                [USER_PHONE_INNER] => 102
                [WORK_PHONE] =>
                [PERSONAL_PHONE] =>
                [PERSONAL_MOBILE] => 79062195047
            )

    )

)
```
