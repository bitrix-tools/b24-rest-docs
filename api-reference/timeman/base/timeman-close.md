# Завершение текущего дня

{% note warning "Мы еще обновляем эту страницу" %}

Тут может не хватать некоторых данных — дополним в ближайшее время

{% endnote %}

{% if build == 'dev' %}

{% note alert "TO-DO _не выгружается на prod_" %}

- нужны правки под стандарт написания
- не указаны типы параметров
- отсутствуют примеры
- отсутствует ответ в случае ошибки

{% endnote %}

{% endif %}

{% note info "timeman.close" %}

**Scope**: [`timeman`](../../scopes/permissions.md) | **Кто может выполнять метод**: `любой пользователь`

{% endnote %}

Метод `timeman.close` завершает текущий рабочий день.

## Параметры

#|
|| **Параметр** | **Описание** ||
|| **USER_ID**
[`unknown`](../../data-types.md) | Идентификатор пользователя. Не обязателен, по умолчанию возвращаются настройки текущего пользователя. ||
|| **TIME**
[`unknown`](../../data-types.md) | Время окончания рабочего дня. Не обязателен, по умолчанию рабочий день закрывается текущим моментом с часовым поясом, в котором рабочий день был начат. Дата должна совпадать с датой начала рабочего дня. ||
|| **REPORT**^*^
[`unknown`](../../data-types.md) | Причина изменения рабочего дня. Обязателен при указании параметра TIME и отключенном для сотрудника свободном графике. ||
|| **LAT**
[`unknown`](../../data-types.md) | Географическая широта начала рабочего дня. Не обязателен. ||
|| **LON**
[`unknown`](../../data-types.md) | Географическая долгота начала рабочего дня. Не обязателен. ||
|#

{% include [Сноска о параметрах](../../../_includes/required.md) %}

Если часовая зона времени завершения рабочего дня отличается от часового пояса начала рабочего дня, то время будет пересчитано в часовой пояс начала дня.

## Пример

Пример вызова:

```http
https://portal.bitrix24.com/rest/timeman.close?auth=xxxxx&time=2017-04-21T17%3A30%3A00%2B09%3A00&report=test&lat=52.5162434&lon=13.3774829&user_id=5
```

{% include [Сноска о примерах](../../../_includes/examples.md) %}

## Ответ в случае успеха

> 200 ОК
```json
{
    "result": {
        "STATUS": "CLOSED",
        "TIME_START": "2017-04-21T07:30:00+08:00",
        "TIME_FINISH": "2017-04-21T16:30:00+08:00",
        "DURATION": "09:00:00",
        "TIME_LEAKS": "00:00:00",
        "ACTIVE": false,
        "IP_OPEN": "192.168.0.1",
        "IP_CLOSE": "192.168.0.100",
        "LAT_OPEN": 54.7199881,
        "LON_OPEN": 20.4879224,
        "LAT_CLOSE": 52.5162434,
        "LON_CLOSE": 13.3774829,
        "TZ_OFFSET": 28800
    }
}
```

### Возвращаемые данные

#|
|| **Поле** | **Описание** | **Примечание** ||
|| **STATUS**
 [`string`](../../data-types.md) | Статус текущего рабочего дня. | Варианты значений:
- OPENED - рабочий день идет
- CLOSED - рабочий день закрыт
- PAUSED - рабочий день приостановлен
- EXPIRED - рабочий день истек (был открыт до начала текущих календарных суток и не закрыт) ||
|| **TIME_START**
[`datetime`](../../data-types.md) | Дата-время начала рабочего дня. | Часовой пояс соответствует часовому поясу начала рабочего дня ||
|| **TIME_FINISH**
[`datetime`](../../data-types.md) | Дата-время заверения рабочего дня | Для незавершенного рабочего дня возвращается null ||
|| **DURATION**
[`HH:MM:SS`](../../data-types.md) | Длительность рабочего дня | Для незавершенного рабочего дня возвращается 00:00:00 ||
|| **TIME_LEAKS**
[`HH:MM:SS`](../../data-types.md) | Суммарная длительность перерыва за день | ||
|| **ACTIVE**
[`true`\|`false`](../../data-types.md) | Подтвержденность рабочего дня | Значение false означает, что изменение рабочего дня ожидает подтверждения руководителем. ||
|| **IP_OPEN**
[`string`](../../data-types.md) | IP-адрес, с которого начат рабочий день | ||
|| **IP_CLOSE**
[`string`](../../data-types.md) | IP-адрес, с которого завершен рабочий день | Для незавершенного рабочего дня возвращается null ||
|| **LAT_OPEN**
[`double`](../../data-types.md) | Географическая широта точки начала рабочего дня | ||
|| **LON_OPEN**
[`double`](../../data-types.md) | Географическая долгота точки начала рабочего дня | ||
|| **LAT_CLOSE**
[`double`](../../data-types.md) | Географическая широта точки завершения рабочего дня | ||
|| **LON_CLOSE**
[`double`](../../data-types.md) | Географическая долгота точки завершения рабочего дня | ||
|| **TZ_OFFSET**
[`int`](../../data-types.md) | Смещение часового пояса сотрудника | Подразумевается часовой пояс, в котором день начат. При завершении дня время завершения приводится к часовому поясу начала дня. ||
|| **TIME_FINISH_DEFAULT**
[`datetime`](../../data-types.md) | Время завершения дня по умолчанию | Выводится только для рабочих дней в статусе EXPIRED. "Рекомендуемое" значение завершения дня, которое можно выводить пользователю в качестве значения по умолчанию. ||
|#